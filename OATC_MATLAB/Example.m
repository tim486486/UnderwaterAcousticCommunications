r = 210; %km
dS,x = [-2 -1 -0.5 -0.25 0 0]'; %ms/km
dC = [4.5 2.2 1.1 0.6 0 0]'; %m/s
dT = [1 0.5 0.25 0.125 0 0]'; %deg C

%Ray  1    2   3   4   5   6   7      Layer
ro = [.02 .04 .06 .08 .11 .14 .17;...  %1
      .04 .06 .09 .13 .19 .26 .37;...  %2 
      .06 .11 .18 .30 .7  .6  .46;...  %3
      .15 .29 .67 .49  0   0   0;...   %4
      .18 .5   0   0   0   0   0;...   %5
      .55  0   0   0   0   0   0;]';   %6

n = [1.7 -1.9 -2.6 2.9 1.3 -1.6 0.2]';%noise

E = r*ro;

dTau = E*x + n; %ms

B = (E'*E)\E';

x_est = B*dTau;
P = (x_est - x)*(x_est - x)';